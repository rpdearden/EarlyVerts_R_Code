library(paleotree)
library(Claddis)
library(paleotree)
library(strap)
setwd("~/Documents/Side_projects/Masters_writeup/EarlyVerts_R_Code/CharRates_pipeline")
Kdata <- ReadMorphNexus("../Keating16.nex")
Ktree <- read.nexus("../KeatMaj.tre")
Kdates <- read.csv("../Keating16Dates.csv", header=TRUE,row.names=1)
#Break polytomies randomly
Ktree <- multi2di(Ktree)
#Reorder dates file to get in line with tree file
Kdates <- Kdates[match(Ktree$tip.label, rownames(Kdates)),]
#Scale tree using fads and lads
Ktree <- DatePhylo(Ktree, Kdates,method="equal", rlen=1)
#plot with geoscale (to check worked)
geoscalePhylo(ladderize(Ktree), cex.age=0.6, cex.ts=0.8, cex.tip=0.8)
#Calculate rates
rate.data <- DiscreteCharacterRate(Ktree, Kdata, seq(Ktree$root.time, Ktree$root.time - max(diag(vcv(Ktree))), length.out=6), alpha=0.01)
#Set up node colours
node.color <- rep("white", nrow(rate.data$node.results))
node.color[which(rate.data$node.results[, "ml.signif.hi.ib"] == 1)] <- "red"
node.color[which(rate.data$node.results[, "ml.signif.lo.ib"] == 1)] <- "blue"
node.color[which(is.na(rate.data$node.results[, "ml.signif.lo.ib"]))] <- NA
# Plot tree with node rates
#pdf("VertNodeRates.pdf")
geoscalePhylo(Ktree, cex.age=0.6, cex.ts=0.8, cex.tip=0.8)
nodelabels(node=rate.data$node.results[, "node"][!is.na(node.color)], pch=21, col="black", bg=node.color[!is.na(node.color)])
#dev.off()
#Set up edge colours
edge.color <- rep("black", nrow(Ktree$edge))
edge.color[which(rate.data$branch.results[, "ml.signif.hi"] == 1)] <- "red"
edge.color[which(rate.data$branch.results[, "ml.signif.lo"] == 1)] <- "blue"
#Plot with these colours
# pdf("VertEdgeRates.pdf")
geoscalePhylo(ladderize(Ktree), cex.age=0.6, cex.ts=0.8, cex.tip=0.8, edge.color=edge.color[match(ladderize(Ktree)$edge[, 2], Ktree$edge[,2])])
# dev.off()
?Claddis
change.times <- runif(100, 0, 100)
time.bins <- seq(100, 0, length.out=11)
ChangesInBins(change.times, time.bins)
# Set random seed:
set.seed(17)
# Generate a random tree for the Michaux data set:
tree <- rtree(nrow(Michaux1989$matrix))
# Update taxon names to match those in the data matrix:
tree$tip.label <- rownames(Michaux1989$matrix)
# Set root time by making youngest taxon extant:
tree$root.time <- max(diag(vcv(tree)))
# Get discrete character rates (includes changes):
out <- DiscreteCharacterRate(tree, Michaux1989,
seq(tree$root.time, 0, length.out = 3), alpha = 0.01)
# Plot character changes on the tree:
PlotCharacterChanges(out$character.changes, tree)
tree<- Ktree
rate.data
rate.data$character.changes
rate.data$node.results
rate.data$per.bin.rates
?seq
rate.data <- DiscreteCharacterRate(Ktree, Kdata, tbins, alpha=0.01)
tbins<-c(541,509,497,485.4,477.7,470,458.4,443.4,433.4,419.2,410.8,393.3,382.7,372.2,358.9,346.7,330.9,323.2,307,298.9,290.1,272.3,259.8,252.17)
rate.data <- DiscreteCharacterRate(Ktree, Kdata, tbins, alpha=0.01)
#Set up edge colours
edge.color <- rep("black", nrow(Ktree$edge))
edge.color[which(rate.data$branch.results[, "ml.signif.hi"] == 1)] <- "red"
edge.color[which(rate.data$branch.results[, "ml.signif.lo"] == 1)] <- "blue"
#Plot with these colours
# pdf("VertEdgeRates.pdf")
geoscalePhylo(ladderize(Ktree), cex.age=0.6, cex.ts=0.8, cex.tip=0.8, edge.color=edge.color[match(ladderize(Ktree)$edge[, 2], Ktree$edge[,2])])
# dev.off()
#Set up node colours
node.color <- rep("white", nrow(rate.data$node.results))
node.color[which(rate.data$node.results[, "ml.signif.hi.ib"] == 1)] <- "red"
node.color[which(rate.data$node.results[, "ml.signif.lo.ib"] == 1)] <- "blue"
node.color[which(is.na(rate.data$node.results[, "ml.signif.lo.ib"]))] <- NA
# Plot tree with node rates
#pdf("VertNodeRates.pdf")
geoscalePhylo(Ktree, cex.age=0.6, cex.ts=0.8, cex.tip=0.8)
nodelabels(node=rate.data$node.results[, "node"][!is.na(node.color)], pch=21, col="black", bg=node.color[!is.na(node.color)])
#dev.off()
#Set up node colours
node.color <- rep("white", nrow(rate.data$node.results))
node.color[which(rate.data$node.results[, "ml.signif.hi.ib"] == 1)] <- "red"
node.color[which(rate.data$node.results[, "ml.signif.lo.ib"] == 1)] <- "blue"
node.color[which(is.na(rate.data$node.results[, "ml.signif.lo.ib"]))] <- NA
# Plot tree with node rates
#pdf("VertNodeRates.pdf")
geoscalePhylo(Ktree, cex.age=0.6, cex.ts=0.8, cex.tip=0.8)
nodelabels(node=rate.data$node.results[, "node"][!is.na(node.color)], pch=21, col="black", bg=node.color[!is.na(node.color)])
#dev.off()
#Set up edge colours
edge.color <- rep("black", nrow(Ktree$edge))
edge.color[which(rate.data$branch.results[, "ml.signif.hi"] == 1)] <- "red"
edge.color[which(rate.data$branch.results[, "ml.signif.lo"] == 1)] <- "blue"
#Plot with these colours
# pdf("VertEdgeRates.pdf")
geoscalePhylo(ladderize(Ktree), cex.age=0.6, cex.ts=0.8, cex.tip=0.8, edge.color=edge.color[match(ladderize(Ktree)$edge[, 2], Ktree$edge[,2])])
# dev.off()
